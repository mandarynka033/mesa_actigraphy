"0","df <- read_func(""mesa-sleep-6003.csv"")"
"0","df2 <- add_summary(df)"
"0","sleep_limit <- median(df2$act5_mean)"
"0","m <- plot_step(df2, nb_iter = 20)"
"0","# "
"0","#     df_prep <- df2 %>%"
"0","#     select(all_of(c(""act5_mean"", ""dummy"", ""ID""))) %>% "
"0","#     as.data.frame() %>% "
"0","#     prepData(type = ""UTM"", coordNames = c(""act5_mean"", ""dummy""))"
"0","# "
"0","#     quant <- quantile(df_prep$step, na.rm = TRUE, names = FALSE)"
"0","#     varian <- var(df_prep$step, na.rm = TRUE)"
"0","#     std <- sqrt(varian)"
"0","# "
"0","#     # Only first state can have zero observations"
"0","#     zeromass0 <- c(0.5, 0, 0)"
"0","#     "
"0","#     # Minimum for optimisation"
"0","#     minim <- Inf"
"0","#     "
"0","#     # Number of random starts"
"0","#     for (j in 1:20) {"
"0","#         mu0 <- sort(runif(3, quant[2], quant[4]))"
"0","#         sigma0 <- sort(runif(3, std, varian))"
"0","#         stepPar0 <- c(mu0, sigma0, zeromass0)      "
"0","#         mod <- try(fitHMM(data = df_prep, nbStates = 3, stepPar0 = stepPar0,"
"0","#                           angleDist = ""none"", stepDist = ""gamma""), "
"0","#                    silent = TRUE)  "
"0","#         if (class(mod)[1] != ""try-error"") {"
"0","#             new_minim <- mod$mod$minimum"
"0","#             enough_states <- try(table(viterbi(mod)), silent = TRUE)"
"0","#             if (class(enough_states) != ""try-error""){"
"0","#                 if (new_minim < minim && length(enough_states) == 3) {"
"0","#                     m3 <- mod"
"0","#                     minim <- new_minim"
"0","#                 }                "
"0","#             }"
"0","#         }"
"0","#     }"
"0","#     if (is.infinite(minim)) {"
"0","#         m3 <- NULL"
"0","#         print(""Did not find a HMM for 3 states"")"
"0","#     }"
"0","#     return(m3)"
"0","# "
"0","# "
"0","# "
"0",""
"0","if (!is.null(m)) {"
"0","    df_sum6003 <- summary_func(m, df, df2, ""act5_mean_sqrt"")"
"0","}"
"1","[1]"
"1"," ""Active states' numbers: 3"""
"1","
"
